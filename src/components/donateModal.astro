---
const currencies = [
    "AED",
    "AFN",
    "ALL",
    "AMD",
    "ANG",
    "AOA",
    "ARS",
    "AUD",
    "AWG",
    "AZN",
    "BAM",
    "BBD",
    "BDT",
    "BGN",
    "BIF",
    "BMD",
    "BND",
    "BOB",
    "BRL",
    "BSD",
    "BWP",
    "BZD",
    "CAD",
    "CDF",
    "CHF",
    "CLP",
    "CNY",
    "COP",
    "CRC",
    "CVE",
    "CZK",
    "DJF",
    "DKK",
    "DOP",
    "DZD",
    "EGP",
    "ETB",
    "EUR",
    "FJD",
    "FKP",
    "GBP",
    "GEL",
    "GHS",
    "GIP",
    "GMD",
    "GNF",
    "GTQ",
    "GYD",
    "HKD",
    "HNL",
    "HRK",
    "HTG",
    "HUF",
    "IDR",
    "ILS",
    "INR",
    "ISK",
    "JMD",
    "JPY",
    "KES",
    "KGS",
    "KHR",
    "KMF",
    "KRW",
    "KYD",
    "KZT",
    "LAK",
    "LBP",
    "LKR",
    "LRD",
    "LSL",
    "MAD",
    "MDL",
    "MGA",
    "MKD",
    "MMK",
    "MNT",
    "MOP",
    "MRO",
    "MUR",
    "MVR",
    "MWK",
    "MXN",
    "MYR",
    "MZN",
    "NAD",
    "NGN",
    "NIO",
    "NOK",
    "NPR",
    "NZD",
    "PAB",
    "PEN",
    "PGK",
    "PHP",
    "PKR",
    "PLN",
    "PYG",
    "QAR",
    "RON",
    "RSD",
    "RUB",
    "RWF",
    "SAR",
    "SBD",
    "SCR",
    "SEK",
    "SGD",
    "SHP",
    "SLL",
    "SOS",
    "SRD",
    "STD",
    "SVC",
    "SZL",
    "THB",
    "TJS",
    "TOP",
    "TRY",
    "TTD",
    "TWD",
    "TZS",
    "UAH",
    "UGX",
    "USD",
    "UYU",
    "UZS",
    "VND",
    "VUV",
    "WST",
    "XAF",
    "XCD",
    "XOF",
    "XPF",
    "YER",
    "ZAR",
    "ZMW",
];
---

<style>
    input[type="radio"]:checked + label {
        @apply bg-orange text-white;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
</style>

<dialog class="p-6 w-1/2 h-1/2">
    <button autofocus>
        <svg width="20" height="20" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>
            <path
                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"
            ></path>
        </svg>
    </button>
    <form id="donationModal">
        <p class="my-2">1. Donation period:</p>
        <div class="flex gap-2">
            <input type="radio" id="one-time" name="interval" value="payment" class="hidden" />
            <label
                for="one-time"
                class="flex-1 text-center px-6 py-3 border-2 border-orange rounded hover:bg-orange hover:text-white duration-300 cursor-pointer">One time</label
            >

            <input type="radio" id="monthly" name="interval" value="month" class="hidden" />
            <label
                for="monthly"
                class="flex-1 text-center px-6 py-3 border-2 border-orange rounded hover:bg-orange hover:text-white duration-300 cursor-pointer">Monthly</label
            >

            <input type="radio" id="yearly" name="interval" value="year" class="hidden" />
            <label for="yearly" class="flex-1 text-center px-6 py-3 border-2 border-orange rounded hover:bg-orange hover:text-white duration-300 cursor-pointer"
                >Yearly</label
            >
        </div>

        <p class="my-2">2. Donation amount:</p>
        <div class="relative rounded-md shadow-sm mt-2">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <span class="text-lightGray text-sm">$</span>
            </div>
            <input
                type="number"
                id="donationAmount"
                step="1"
                min="1"
                class="w-full rounded-md py-1.5 pl-7 pr-12 text-black ring-1 ring-inset ring-[#858ebe] placeholder:text-lightGray outline-none focus:ring-orange leading-6"
                placeholder="1"
                name="amount"
            />
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                <select
                    title="Currency"
                    name="currency"
                    class="bg-transparent border-none text-lightGray text-sm pointer-events-auto absolute inset-y-0 right-0 flex items-center outline-none"
                >
                    {currencies.map((currency) => <option value={currency}>{currency}</option>)}
                </select>
            </div>
        </div>
        <button
            type="submit"
            class="text-center hover:text-white px-6 py-3 border-2 border-orange disabled:border-[#c79a75] rounded hover:enabled:bg-orange duration-300 mt-2"
            >Donate ðŸ’›
        </button>
    </form>
</dialog>

<script>
    const dialog = document.querySelector("dialog");
    const showButton = document.querySelector("#donateBtn");
    const closeButton = document.querySelector("dialog button");

    // "Show the dialog" button opens the dialog modally
    showButton.addEventListener("click", () => {
        dialog.showModal();
    });

    // "Close" button closes the dialog
    closeButton.addEventListener("click", () => {
        dialog.close();
    });

    // Donate form submission
    document.querySelector("#donationModal").addEventListener("submit", (e) => {
        e.preventDefault();
        // Get form data as JSON object
        const formData = Object.fromEntries(new FormData(e.target).entries());

        fetch("/stripe-checkout", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
        })
            .then((res) => res.json())
            .then((res) => {
                if (!res.success) {
                    console.error(res.error);
                    return;
                }

                // Redirect to Stripe's payment page
                window.location = res.data.redirect_url;
            })
            .catch((e) => {
                console.error(e);
            });
    });
</script>
